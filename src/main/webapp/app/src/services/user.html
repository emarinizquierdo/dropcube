<dom-module id="user-service">

    <template>
        <iron-cookie name="JSESSIONID" value="{{value}}" uri-safe expires="{{expires}}"></iron-cookie>
        <iron-ajax auto url="/s/users/me"  handle-as="json" on-response="_onResponse" last-response="{{userData}}"></iron-ajax>
        <iron-ajax id="userLogout" url="/s/users/logout"  handle-as="json" on-response="_onLogout"></iron-ajax>
    </template>



    <script>

        function User( ) {

            this.data = null;

            this.isAdmin = function() {
                return (this.data.role == 'ADMIN');
            }

            this.isLogged = false;

            this.logout = function(){}

        }

        // element registration
        Polymer({
            is: "user-service",
            properties: {
                user: {
                    type: Object,
                    notify: true,
                    value : new User()
                },
                langService : {
                  type : Object
                }
            },

            listeners : {
              'logout' : '_logout'
            },

            _logout : function(){
              this.$.userLogout.generateRequest();
            },

            _onResponse : function(data){

              var _user = new User();

              if(this.userData){
                _user.isLogged = true;
                _user.data = this.userData.data;
                _user.logout = this._logout.bind(this);
                if(this.userData && this.userData.data && this.userData.data.lang){
                  this.langService.setLang(this.userData.data.lang);
                }
              }

              this.set('user', _user);
            },

            _onLogout : function(){
              this.set('user.isLogged', false);
            }

        });
    </script>

</dom-module>
