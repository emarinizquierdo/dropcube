<dom-module id="dropcube-content">

    <template>

        <style is="custom-style">
            .main-wrapper {
                padding-top: 64px;
            }

            .spacer {
                height: 64px;
            }

            iron-pages {
                height: 100%;
            }
        </style>
        <!-- .............. GENERAL RESOURCES  .............. -->
        <dropcube-icons-set></dropcube-icons-set>
        <!-- ............ END GENERAL RESOURCES  .............. -->


        <!-- ..............   MODEL CONTROL  .............. -->
        <lang-service id="langService" lang-service="{{langService}}" dictionary="{{dictionary}}" src="lang/locales.json"></lang-service>
        <user-service id="userService" lang-service="{{langService}}" user="{{user}}"></user-service>

        <!-- ..............  END MODEL CONTROL .............. -->

        <template is="dom-if" if="{{_isMain(routeData)}}">
            <dropcube-header dictionary="{{dictionary}}" user="{{user}}" loading="{{loading}}"></dropcube-header>
        </template>

        <div class="main-wrapper layout-column layout-fill">
            <div class="flex-grow">
                <app-location id="appLocation" route="{{route}}"></app-location>
                <app-route route="{{route}}" pattern="/:view" data="{{routeData}}" tail="{{subroute}}"></app-route>
                <app-route route="{{subroute}}" pattern="/:id" data="{{subrouteData}}">
                </app-route>
                <iron-pages selected="[[routeData.view]]" attr-for-selected="name">
                    <dropcube-settings id="dropcubeSettings" name="settings" lang-service="{{langService}}" dictionary="{{dictionary}}" user="{{user}}" loading="{{_loading3}}"></dropcube-settings>
                    <dropcube-helps name="help"></dropcube-helps>
                    <dropcube-main name="" dictionary="{{dictionary}}" user="{{user}}"></dropcube-main>
                    <dropcube-login name="login" dictionary="{{dictionary}}"></dropcube-login>
                    <dropcube-devices id="dropcubeDevices" name="devices" dictionary="{{dictionary}}" loading="{{_loading1}}"></dropcube-devices>
                    <dropcube-device id="dropcubeDevice" route="{{subrouteData}}" name="device" dictionary="{{dictionary}}" loading="{{_loading2}}"></dropcube-device>
                </iron-pages>
            </div>
            <dropcube-footer class="flex-nogrow" dictionary="{{dictionary}}"></dropcube-footer>
        </div>

    </template>

    <script>
        Polymer({
            is: "dropcube-content",
            properties: {
                user: {
                    type: Object
                },
                loading: {
                    type: Boolean,
                    value: false
                },
                _loading1: {
                    type: Boolean,
                    value: false
                },
                _loading2: {
                    type: Boolean,
                    value: false
                },
                _loading3: {
                    type: Boolean,
                    value: false
                }
            },
            observers: [
                '_loading(_loading1, _loading2, _loading3)'
            ],
            listeners : {
              "deleted" : "_onDeleted"
            },
            _isMain: function(route) {
                return route.view != "";
            },
            _loading: function(loading1, loading2, loading3) {
                this.loading = loading1 || loading2 || loading3;
            },
            _onDeleted: function(){
              this.set("route.path", "/devices");
              this.$.dropcubeDevices.fire("afterdelete");
            }

        });
    </script>

</dom-module>
